{# templates/evenement/rejoindre.html.twig #}

{% extends 'base2.html.twig' %}

{% block title %}Rejoindre l'événement - {{ evenement.titre }}{% endblock %}
{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
{% endblock %}

{% block body %}
{% set today = "now"|date("Y-m-d") %}
{% set eighty_years_ago = "now"|date_modify("-80 years")|date("Y-m-d") %}

<div class="container py-5">
    <h1 class="mb-4 display-5 fw-bold">Inscription à : {{ evenement.titre }}</h1>
    
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="bg-light p-4 p-lg-5 rounded-4 shadow-lg">
                {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate', 'id': 'inscription-form'}}) }}
                
                    <!-- Section Informations personnelles -->
                    <div class="mb-5">
                        <h4 class="mb-4 fw-semibold border-bottom pb-2">Informations personnelles</h4>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ form_row(form.nomComplet, {
                                    'label': 'Nom et prénom *',
                                    'attr': {'class': 'form-control'}
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.dateNaissance, {
                                    'label': 'Date de naissance *',
                                    'attr': {
                                        'class': 'form-control',
                                        'min': eighty_years_ago,
                                        'max': today
                                    }
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.profession, {
                                    'label': 'Profession/Statut *',
                                    'attr': {'class': 'form-control'}
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.tailleTshirt, {
                                    'label': 'Taille de T-shirt',
                                    'attr': {'class': 'form-select'}
                                }) }}
                            </div>
                        </div>
                    </div>

                    <!-- Section Préférences -->
                    <div class="mb-5">
                        <h4 class="mb-4 fw-semibold border-bottom pb-2">Préférences</h4>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ form_row(form.activiteGroupe, {
                                    'label': 'Participation aux activités de groupe',
                                    'attr': {'class': 'form-select'}
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.competences, {
                                    'label': 'Compétences spécifiques',
                                    'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'Musique, peinture, organisation...'
                                    }
                                }) }}
                            </div>
                        </div>
                    </div>

                    <!-- Section Santé et accessibilité -->
                    <div class="mb-5">
                        <h4 class="mb-4 fw-semibold border-bottom pb-2">Santé & Accessibilité</h4>
                        
                        <div class="row g-3">
                            <div class="col-12">
                                {{ form_row(form.regimesAlimentaires, {
                                    'label': 'Restrictions alimentaires',
                                    'attr': {'class': 'form-select'}
                                }) }}
                            </div>
                            <div class="col-12">
                                {{ form_row(form.accessibilite, {
                                    'label': 'Besoins d\'accessibilité',
                                    'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'Accès PMR, interprète LSF...'
                                    }
                                }) }}
                            </div>
                        </div>
                    </div>

                    <!-- Section Engagement -->
                    <div class="mb-5">
                        <h4 class="mb-4 fw-semibold border-bottom pb-2">Engagement</h4>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ form_row(form.reglesSecurite, {
                                    'label': 'J\'accepte les règles de sécurité *',
                                    'attr': {'class': 'form-check-input'}
                                }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.benevolat, {
                                    'label': 'Souhaitez-vous être bénévole ?',
                                    'attr': {'class': 'form-select'}
                                }) }}
                            </div>
                            <div class="col-12">
                                {{ form_row(form.sondageSatisfaction, {
                                    'label': 'Sondage de satisfaction',
                                    'attr': {'class': 'form-check-input'}
                                }) }}
                            </div>
                        </div>
                    </div>

                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-join btn-lg text-black rounded-3">
                            <i class="fas fa-check me-2"></i>Confirmer l'inscription
                        </button>
                    </div>

                {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.getElementById('inscription-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Vérification de la validité du formulaire
    if (!this.checkValidity()) {
        this.classList.add('was-validated');
        return;
    }

    // Configuration de la popup
    Swal.fire({
        title: 'Confirmation finale',
        html: `<div class="text-start">
                <p>Veuillez confirmer votre inscription à :</p>
                <h5 class="text-primary">${document.querySelector('h1').innerText}</h5>
                <div class="mt-3">
                    <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                    Cette action est irréversible
                </div>
              </div>`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#4CAF50',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Confirmer définitivement',
        cancelButtonText: 'Revoir mes informations',
        customClass: {
            popup: 'border-radius-15',
            actions: 'mt-4'
        },
        showLoaderOnConfirm: true,
        preConfirm: () => {
            return new Promise((resolve) => {
                // Soumission réelle du formulaire après 1s
                setTimeout(() => {
                    document.getElementById('inscription-form').submit();
                    resolve();
                }, 1000);
            })
        }
    }).then((result) => {
        if (result.isConfirmed) {
            // Animation de succès après soumission
            Swal.fire({
                title: 'Inscription enregistrée !',
                text: 'Découvrez l\'âme festive de la Tunisie avec nos événements.',
                icon: 'success',
                timer: 2000,
                timerProgressBar: true,
                showConfirmButton: false
            });
        }
    });
});
</script>

{% endblock %}

