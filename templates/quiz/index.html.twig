{% extends 'base.html.twig' %}

{% block stylesheets %}
    <style>
        .create-button {
            background-color: var(--primary-color);
            border: 0;
            border-radius: var(--border-radius-large) !important;
            color: var(--white-color);
            max-width: 150px;
            padding: 10px 20px;
            text-align: center;
            display: inline-block;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .badge.bg-danger { background-color: #dc3545; }
        .badge.bg-success { background-color: #28a745; }
        .badge.bg-warning { background-color: #ffc107; }
        .badge.bg-secondary { background-color: #6c757d; }
    </style>
{% endblock %}

{% block body %}
    <!-- Section Explorer les Quiz -->
    <section class="explore-section section-padding" id="section_2">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h2 class="mb-4">Explorer les Quiz</h2>
                </div>
            </div>
        </div>

        <!-- Onglets de Filtre par Statut de Quiz -->
        <div class="container-fluid">
            <div class="row">
                <ul class="nav nav-tabs" id="quizStatusTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="all-quiz-tab" data-quiz-status="all" type="button" role="tab" aria-controls="all-quiz-tab-pane" aria-selected="true">Tous les Quiz</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="empty-quiz-tab" data-quiz-status="empty" type="button" role="tab" aria-controls="empty-quiz-tab-pane" aria-selected="false">Quiz Vides</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="taken-quiz-tab" data-quiz-status="taken" type="button" role="tab" aria-controls="taken-quiz-tab-pane" aria-selected="false">Quiz Commencés</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="complete-quiz-tab" data-quiz-status="complete" type="button" role="tab" aria-controls="complete-quiz-tab-pane" aria-selected="false">Quiz Complets</button>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Section Index des Quiz -->
    <section>
        <!-- Grille des Quiz -->
        <div class="container">
            <div class="row">
                {% for quiz in quizzes %}
                    <div class="col-lg-4 col-md-6 col-12 mb-4 quiz-row" data-quiz-status="{{ quiz.questions|length == 0 ? 'empty' : (quiz.questions|length == 10 ? 'complete' : 'taken') }}">
                        <div class="custom-block bg-white shadow-lg">
                            <a href="{{ path('app_question_index', {'quizId': quiz.id}) }}">
                                <div class="d-flex">
                                    <div>
                                        <h5 class="mb-2">{{ quiz.livre ? quiz.livre.titre : 'Aucun livre associé' }}</h5>
                                       {% if quiz.livre and quiz.livre.imageCouverture %}
    <img src="{{ asset('uploads/images/' ~ quiz.livre.imageCouverture) }}" alt="Image Couverture" class="img-fluid">
{% else %}
    <p class="mb-0">Aucune image disponible</p>
{% endif %}
                                    </div>
                                </div>
                            </a>

                            <!-- Quiz Status Badge -->
                            <div class="mt-3">
                                {% if quiz.questions|length == 0 %}
                                    <span class="badge bg-danger">Quiz Vide</span>
                                {% elseif quiz.questions|length == 10 %}
                                    <span class="badge bg-success">Quiz Complet</span>
                                {% else %}
                                    <span class="badge bg-warning">Quiz Commencé</span>
                                {% endif %}
                            </div>

                            <!-- Actions -->
                            <div class="d-flex justify-content-between mt-3">
                                <a href="{{ path('app_question_index', {'quizId': quiz.id}) }}" class="btn btn-sm btn-outline-primary">Voir les Questions</a>
                               <form action="{{ path('app_quiz_delete', {'id': quiz.id}) }}" method="post" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce quiz ?');">
    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ quiz.id) }}">
    <input type="hidden" name="_method" value="DELETE">
    <button type="submit" class="btn btn-sm btn-outline-danger">Supprimer</button>
</form>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="col-12">
                        <div class="no-records text-center">
                            <p>Aucun quiz trouvé</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Bouton Créer -->
    <div class="col-lg-4 col-12 ms-auto">
        <a href="{{ path('app_quiz_new') }}" class="create-button">Créer</a>
    </div>

    <!-- Section Contact -->
    <section class="contact-section section-padding section-bg" id="section_5">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-12 text-center">
                    <h2 class="mb-5">Une expérience à attendre avec impatience</h2>
                </div>

                <div class="col-lg-5 col-12 mb-4 mb-lg-0">
                    <iframe class="google-map" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3035.1332484834716!2d10.297478475647058!3d36.83944667223597!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12fd4ad74bdd8285%3A0x58721aef6c2db516!2sLe%20Kram%20-%20Exhibition%20and%20International%20Trade%20Center%20of%20Tunis!5e1!3m2!1sen!2sth!4v1740497472546!5m2!1sen!2sth" width="100%" height="250" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>

                <div class="col-lg-3 col-md-6 col-12 mb-3 mb-lg- mb-md-0 ms-auto">
                    <h4 class="mb-3">Lieu de l'Événement</h4>
                    <p>Kram, Tunisie</p>
                    <hr>
                    <p>Date : du 25 avril au 4 mai 2025</p>
                </div>

                <div class="col-lg-3 col-md-6 col-12 mx-auto">
                    <h4 class="mb-3">Informations de Contact</h4>
                    <p>Si vous avez des questions, n'hésitez pas à nous contacter :</p>
                    <hr>
                    <p class="d-flex align-items-center mb-1">
                        <span class="me-2">Lien</span>
                        <a href="https://foire.e-festivals.tn" class="site-footer-link">
                            https://foire.e-festivals.tn
                        </a>
                    </p>
                    <p class="d-flex align-items-center">
                        <span class="me-2">Email</span>
                        <a href="foiredulivre@enpfmca.gov.tn" class="site-footer-link">
                            foiredulivre@enpfmca.gov.tn
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- JavaScript pour le Filtrage par Statut de Quiz -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const quizStatusFilterButtons = document.querySelectorAll('#quizStatusTab .nav-link');
            const quizRows = document.querySelectorAll('.quiz-row');

            // Function to filter quizzes by status
            function filterQuizzes(selectedQuizStatus) {
                quizRows.forEach(row => {
                    const rowQuizStatus = row.getAttribute('data-quiz-status');

                    const quizStatusMatch = selectedQuizStatus === 'all' || rowQuizStatus === selectedQuizStatus;

                    if (quizStatusMatch) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }

            // Add event listeners for quiz status filters
            quizStatusFilterButtons.forEach(button => {
                button.addEventListener('click', function () {
                    quizStatusFilterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    const selectedQuizStatus = this.getAttribute('data-quiz-status');
                    filterQuizzes(selectedQuizStatus);
                });
            });
        });
    </script>
{% endblock %}